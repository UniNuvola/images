include buildinfo.mk

BRANCH:=$(shell git branch --show-current)

.PHONY: all 
all: check build push tag

.PHONY: check
check:
ifeq ($(IMAGE),)
	$(error "Missing IMAGE") 
endif

.PHONY: build
build: check
	docker build --build-arg GIT_BRANCH=$(BRANCH) -t $(IMAGE):$(BRANCH) .

.PHONY: push
push: check
	docker push $(IMAGE):$(BRANCH)

# TODO: remove remote images ??
.PHONY: untag
untag: check
	docker image rm $(IMAGE):$(BRANCH)
